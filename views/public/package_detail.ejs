<section class="package-detail-page">
    <div class="package-hero-v2">
        <div class="container">
            <nav class="breadcrumb-v2">
                <a href="/home">Home</a>
                <span class="sep">/</span>
                <a href="/packages">Packages</a>
                <span class="sep">/</span>
                <span class="active">
                    <%= package.name %>
                </span>
            </nav>

            <div class="hero-split">
                <div class="hero-text-side">
                    <div class="bundle-label">
                        <%= package.bundle_label || 'Premium Medical Bundle' %>
                    </div>
                    <h1 class="hero-title">
                        <%= package.name %>
                    </h1>
                    <p class="hero-lead">
                        <%= package.description %>
                    </p>

                    <div class="hero-key-specs">
                        <% if (package.specs && package.specs.length> 0) { %>
                            <% package.specs.forEach(spec=> { %>
                                <div class="spec-row">
                                    <span class="spec-icon"><i class="<%= spec.icon %>"></i></span>
                                    <span class="spec-text">
                                        <%= spec.spec_text %>
                                    </span>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <div class="spec-row">
                                            <span class="spec-icon"><i class="fa-solid fa-list-check"></i></span>
                                            <span class="spec-text">Includes <%= package.products.length %> specialized
                                                    components</span>
                                        </div>
                                        <div class="spec-row">
                                            <span class="spec-icon"><i class="fa-solid fa-shield-medical"></i></span>
                                            <span class="spec-text">Full MDA Certified Equipment</span>
                                        </div>
                                        <div class="spec-row">
                                            <span class="spec-icon"><i class="fa-solid fa-truck-fast"></i></span>
                                            <span class="spec-text">Priority delivery and installment</span>
                                        </div>
                                        <% } %>
                    </div>

                    <div class="hero-actions">
                        <a href="#included-products" class="btn-primary-v2">Explore Products</a>
                        <a href="/contact" class="btn-outline-v2">Inquire Now</a>
                    </div>
                </div>

                <div class="hero-image-side">
                    <% if (package.main_image) { %>
                        <div class="package-main-image-preview">
                            <img src="<%= package.main_image %>" alt="<%= package.name %>"
                                style="width: 100%; height: 100%; object-fit: contain; border-radius: 20px;">
                        </div>
                        <% } else { %>
                            <div class="product-bundle-preview">
                                <% if (package.products.length> 0) { %>
                                    <div class="preview-stack">
                                        <% package.products.slice(0, 3).forEach((prod, i)=> { %>
                                            <div class="stack-item item-<%= i %>">
                                                <% if (prod.main_image) { %>
                                                    <img src="<%= prod.main_image %>" alt="<%= prod.model %>">
                                                    <% } else { %>
                                                        <div class="img-placeholder"><i class="fa-solid fa-box"></i>
                                                        </div>
                                                        <% } %>
                                            </div>
                                            <% }) %>
                                    </div>
                                    <% } %>
                            </div>
                            <% } %>
                </div>
            </div>
        </div>
    </div>

    <div id="included-products" class="container package-content-section">
        <div class="section-header">
            <h2>Included Products (<%= package.products.length %>)</h2>
            <p>Everything you need in one complete package</p>
        </div>

        <div class="products-grid">
            <% package.products.forEach(p=> { %>
                <a href="/product/<%= p.id %>" class="product-card">
                    <div class="product-image-box">
                        <% if (p.main_image) { %>
                            <img src="<%= p.main_image %>" alt="<%= p.model %>">
                            <% } else { %>
                                <div class="placeholder-img"><i class="fa-solid fa-image"></i></div>
                                <% } %>
                                    <div class="view-overlay">
                                        <span>View Product Details</span>
                                    </div>
                    </div>
                    <div class="product-info-box">
                        <div class="product-meta">
                            <span class="code-span">
                                <%= p.code %>
                            </span>
                            <% if(p.mda_reg_no) { %>
                                <span class="mda-span"><i class="fa-solid fa-certificate"></i> MDA</span>
                                <% } %>
                        </div>
                        <h3 class="product-title-h3">
                            <%= p.model %>
                        </h3>
                        <p class="product-short-desc">
                            <%= p.description ? (p.description.length> 80 ? p.description.substring(0, 80) + '...' :
                                p.description) : 'Professional medical equipment.' %>
                        </p>
                    </div>
                </a>
                <% }) %>
        </div>

        <div class="package-cta">
            <div class="cta-card">
                <div class="cta-content">
                    <h3>Interested in this package?</h3>
                    <p>Our specialists can help you with a customized quote and consultation.</p>
                </div>
                <div class="cta-action">
                    <a href="/contact" class="btn-cta">Contact Sales Representative</a>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .package-detail-page {
        padding-bottom: 5rem;
    }

    .package-hero-v2 {
        background: #f8fafc;
        padding: 4rem 0 6rem;
        border-bottom: 1px solid var(--gray-200);
        overflow: hidden;
    }

    .breadcrumb-v2 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 3rem;
    }

    .breadcrumb-v2 a {
        color: var(--gray-500);
    }

    .breadcrumb-v2 .sep {
        color: var(--gray-300);
    }

    .breadcrumb-v2 .active {
        color: var(--blue-medium);
    }

    .hero-split {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 4rem;
        align-items: center;
    }

    .bundle-label {
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--blue-medium);
        text-transform: uppercase;
        letter-spacing: 0.15em;
        margin-bottom: 1rem;
        display: inline-block;
        padding-left: 2rem;
        position: relative;
    }

    .bundle-label::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        width: 1.5rem;
        height: 2px;
        background: var(--blue-medium);
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 900;
        color: var(--blue-darkest);
        line-height: 1.1;
        margin-bottom: 1.5rem;
        letter-spacing: -0.02em;
    }

    .hero-lead {
        font-size: 1.15rem;
        color: var(--gray-600);
        line-height: 1.6;
        margin-bottom: 2.5rem;
        max-width: 600px;
    }

    .hero-key-specs {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 3rem;
    }

    .spec-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--gray-700);
        font-weight: 500;
    }

    .spec-icon {
        color: var(--blue-medium);
        font-size: 1rem;
        width: 20px;
    }

    .hero-actions {
        display: flex;
        gap: 1rem;
    }

    .btn-primary-v2 {
        background: var(--blue-darkest);
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: 700;
        transition: all 0.2s;
    }

    .btn-primary-v2:hover {
        background: var(--blue-dark);
        color: white;
        transform: translateY(-2px);
    }

    .btn-outline-v2 {
        border: 2px solid var(--gray-200);
        color: var(--blue-darkest);
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: 700;
        transition: all 0.2s;
    }

    .btn-outline-v2:hover {
        border-color: var(--blue-medium);
        color: var(--blue-medium);
        background: var(--gray-50);
    }

    /* Product Preview Stack */
    .product-bundle-preview {
        position: relative;
        height: 450px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .preview-stack {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .stack-item {
        position: absolute;
        background: white;
        padding: 1rem;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--gray-100);
        width: 280px;
        height: 280px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .stack-item img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    .item-0 {
        z-index: 3;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .item-1 {
        z-index: 2;
        top: 40%;
        left: 40%;
        transform: translate(-50%, -50%) rotate(-8deg);
    }

    .item-2 {
        z-index: 1;
        top: 60%;
        left: 60%;
        transform: translate(-50%, -50%) rotate(8deg);
    }

    .product-bundle-preview:hover .item-1 {
        transform: translate(-80%, -60%) rotate(-15deg);
    }

    .product-bundle-preview:hover .item-2 {
        transform: translate(-20%, -40%) rotate(15deg);
    }

    .package-content-section {
        padding: 6rem 0;
    }

    .package-grid-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .section-header {
        margin-bottom: 3rem;
    }

    .section-header h2 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--blue-darkest);
        margin-bottom: 0.5rem;
    }

    .section-header p {
        color: var(--gray-600);
        font-size: 1.1rem;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 5rem;
    }

    .product-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 16px;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        text-decoration: none;
        color: inherit;
        border-color: var(--blue-light);
    }

    .product-image-box {
        position: relative;
        height: 240px;
        background: var(--gray-50);
        overflow: hidden;
    }

    .product-image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .product-image-box img {
        transform: scale(1.08);
    }

    .view-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0, 59, 92, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .product-card:hover .view-overlay {
        opacity: 1;
    }

    .view-overlay span {
        color: white;
        font-weight: 700;
        padding: 0.75rem 1.5rem;
        border: 2px solid white;
        border-radius: 8px;
        transform: translateY(10px);
        transition: transform 0.3s ease;
    }

    .product-card:hover .view-overlay span {
        transform: translateY(0);
    }

    .product-info-box {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .product-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .code-span {
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--blue-medium);
        background: rgba(0, 91, 150, 0.1);
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        text-transform: uppercase;
    }

    .mda-span {
        font-size: 0.75rem;
        color: var(--success);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .product-title-h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--blue-darkest);
        margin: 0 0 0.75rem 0;
        line-height: 1.3;
    }

    .product-short-desc {
        font-size: 0.9rem;
        color: var(--gray-600);
        line-height: 1.5;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .package-cta {
        margin-top: 2rem;
    }

    .cta-card {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 24px;
        padding: 3rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }

    .cta-content h3 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--blue-darkest);
        margin: 0 0 0.5rem 0;
    }

    .cta-content p {
        color: var(--gray-600);
        font-size: 1.1rem;
        margin: 0;
    }

    .btn-cta {
        background: var(--blue-medium);
        color: white;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 700;
        text-decoration: none;
        white-space: nowrap;
        transition: background 0.2s;
    }

    .btn-cta:hover {
        background: var(--blue-dark);
        color: white;
        text-decoration: none;
    }

    @media (max-width: 991px) {
        .cta-card {
            flex-direction: column;
            text-align: center;
            padding: 2rem;
        }

        .hero-content h1 {
            font-size: 2.75rem;
        }
    }

    @media (max-width: 768px) {
        .package-hero {
            padding: 3rem 0 5rem;
        }

        .hero-content h1 {
            font-size: 2.25rem;
        }

        .hero-content p {
            font-size: 1.1rem;
        }

        .section-header h2 {
            font-size: 1.5rem;
        }
    }
</style>